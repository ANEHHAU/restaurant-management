<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head th:replace="layout/header :: head"></head>-->

<!--<style>-->

<!--    .btn-view-schedule {-->
<!--        background: #e3f2fd;              /* xanh d∆∞∆°ng nh·∫°t r·∫•t ƒë·∫πp */-->
<!--        color: #1976d2;                   /* ch·ªØ xanh ƒë·∫≠m */-->
<!--        border: none;-->
<!--        padding: 8px 16px;-->
<!--        font-size: 14px;-->
<!--        font-weight: 600;-->
<!--        border-radius: 8px;               /* bo g√≥c tr√≤n */-->
<!--        cursor: pointer;-->
<!--        transition: all 0.25s ease;-->
<!--        box-shadow: 0 2px 4px rgba(25, 118, 210, 0.15);-->
<!--    }-->

<!--    .btn-view-schedule:hover {-->
<!--        background: #bbdefb;-->
<!--        transform: translateY(-1px);-->
<!--        box-shadow: 0 4px 8px rgba(25, 118, 210, 0.25);-->
<!--    }-->

<!--    .btn-view-schedule:active {-->
<!--        transform: translateY(0);-->
<!--        box-shadow: 0 1px 2px rgba(25, 118, 210, 0.2);-->
<!--    }-->



<!--    /* STATUS TABLE */-->
<!--    .status-active { background:#d4f8d4; color:#0f730c; padding:5px 10px; border-radius:6px; font-weight:bold; }-->
<!--    .status-inactive { background:#fff4c2; color:#8a6d00; padding:5px 10px; border-radius:6px; font-weight:bold; }-->

<!--    /* SCHEDULE STATUS BADGE */-->
<!--    .st-pending { background:#ffe7a3; color:#8a6700; padding:4px 8px; border-radius:5px; font-weight:bold; }-->
<!--    .st-confirmed { background:#c8ffd4; color:#0a6c20; padding:4px 8px; border-radius:5px; font-weight:bold; }-->
<!--    .st-cancelled { background:#ffd1d1; color:#a30000; padding:4px 8px; border-radius:5px; font-weight:bold; }-->
<!--    .st-completed { background:#d7e6ff; color:#003c91; padding:4px 8px; border-radius:5px; font-weight:bold; }-->

<!--    .overlay {-->
<!--        display:none; position:fixed; inset:0;-->
<!--        background:rgba(0,0,0,0.4);-->
<!--        z-index:999; justify-content:center; align-items:center;-->
<!--    }-->

<!--    .popup {-->
<!--        background:white; width:750px; max-height:80vh;-->
<!--        padding:20px; border-radius:12px;-->
<!--        overflow-y:auto; position:relative;-->
<!--        box-shadow:0 4px 15px rgba(0,0,0,0.3);-->
<!--    }-->

<!--    .btn-close {-->
<!--        position:absolute;-->
<!--        top:10px; right:10px;-->
<!--        background:red; color:white;-->
<!--        padding:6px 12px; border:none;-->
<!--        border-radius:6px; cursor:pointer;-->
<!--    }-->

<!--    .past { background:#e0e0e0; }-->
<!--    .upcoming { background:#d8e9ff; }-->

<!--    th, td { border:1px solid #ccc; padding:8px; }-->
<!--</style>-->


<!--<body>-->
<!--<div th:replace="layout/header :: menu"></div>-->

<!--<h1>Qu·∫£n l√Ω b√†n</h1>-->

<!--<table>-->
<!--    <tr>-->
<!--        <th>ID</th>-->
<!--        <th>T√™n b√†n</th>-->
<!--        <th>S·ªë gh·∫ø</th>-->
<!--        <th>Tr·∫°ng th√°i</th>-->
<!--        <th>T·ªïng doanh thu</th>-->
<!--        <th>L·ªãch ƒë·∫∑t b√†n</th>-->
<!--    </tr>-->

<!--    <tr th:each="t : ${tables}">-->
<!--        <td th:text="${t[0]}"></td>-->
<!--        <td th:text="${t[1]}"></td>-->
<!--        <td th:text="${t[2]}"></td>-->

<!--        <td>-->
<!--            <span th:class="${#strings.equalsIgnoreCase(t[3],'ACTIVE') ? 'status-active':'status-inactive'}"-->
<!--                  th:text="${#strings.equalsIgnoreCase(t[3],'ACTIVE') ? 'ƒêang ho·∫°t ƒë·ªông':'Ch∆∞a ho·∫°t ƒë·ªông'}">-->
<!--            </span>-->
<!--        </td>-->

<!--        <td th:text="${#numbers.formatDecimal(t[4],0,'COMMA',0,'POINT')} + ' ‚Ç´'"></td>-->


<!--        <td>-->
<!--            <button class="btn-view-schedule"-->
<!--                    th:data-table-id="${t[0]}"-->
<!--                    th:data-table-name="${t[1]}"-->
<!--                    onclick="handleShowSchedule(this)">-->
<!--                Chi ti·∫øt-->
<!--            </button>-->
<!--        </td>-->

<!--    </tr>-->
<!--</table>-->


<!--&lt;!&ndash; POPUP &ndash;&gt;-->
<!--<div id="overlay" class="overlay">-->
<!--    <div class="popup" id="popup-content"></div>-->
<!--</div>-->

<!--<script>-->
<!--    function handleShowSchedule(button) {-->
<!--        const tableId = button.getAttribute('data-table-id');-->
<!--        const tableName = button.getAttribute('data-table-name');-->
<!--        showSchedule(tableId, tableName);-->
<!--    }-->


<!--    function closePopup() {-->
<!--        document.getElementById("overlay").style.display = "none";-->
<!--    }-->

<!--    function showPopup(html) {-->
<!--        document.getElementById("popup-content").innerHTML =-->
<!--            '<button class="btn-close" onclick="closePopup()">ƒê√≥ng</button>' + html;-->

<!--        document.getElementById("overlay").style.display = "flex";-->
<!--    }-->

<!--    /* üîµ SHOW SCHEDULE POPUP */-->
<!--    async function showSchedule(tableId, tableName) {-->
<!--        let res = await fetch(`/tables/${tableId}/schedule`);-->
<!--        let data = await res.json();-->
<!--        let now = new Date();-->

<!--        if (data.length === 0) {-->
<!--            showPopup(`<h3>L·ªãch ƒë·∫∑t b√†n ‚Äì ${tableName}</h3><p>Kh√¥ng c√≥ l·ªãch.</p>`);-->
<!--            return;-->
<!--        }-->

<!--        let rows = data.map(r => {-->
<!--            let start = new Date(r.start);-->
<!--            let css = start < now ? "past" : "upcoming";-->

<!--            let statusHtml =-->
<!--                r.status === "PENDING"   ? "<span class='st-pending'>Ch·ªù x√°c nh·∫≠n</span>" :-->
<!--                    r.status === "CONFIRMED" ? "<span class='st-confirmed'>ƒê√£ x√°c nh·∫≠n</span>" :-->
<!--                        r.status === "CANCELLED" ? "<span class='st-cancelled'>ƒê√£ h·ªßy</span>" :-->
<!--                            "<span class='st-completed'>Th√†nh c√¥ng</span>";-->

<!--            return `-->
<!--                <tr class="${css}">-->
<!--                    <td>${r.customer} (${r.phone})</td>-->
<!--                    <td>${formatDate(r.start)}</td>-->
<!--                    <td>${formatDate(r.end)}</td>-->
<!--                    <td>${statusHtml}</td>-->
<!--                </tr>-->
<!--            `;-->
<!--        }).join("");-->

<!--        let html = `-->
<!--            <h3>L·ªãch ƒë·∫∑t b√†n ‚Äì ${tableName}</h3>-->
<!--            <table>-->
<!--                <tr>-->
<!--                    <th>Kh√°ch h√†ng</th>-->
<!--                    <th>B·∫Øt ƒë·∫ßu</th>-->
<!--                    <th>K·∫øt th√∫c</th>-->
<!--                    <th>Tr·∫°ng th√°i</th>-->
<!--                </tr>-->
<!--                ${rows}-->
<!--            </table>-->
<!--        `;-->

<!--        showPopup(html);-->
<!--    }-->

<!--    function formatDate(str) {-->
<!--        let d = new Date(str);-->
<!--        let dd = String(d.getDate()).padStart(2, '0');-->
<!--        let mm = String(d.getMonth()+1).padStart(2, '0');-->
<!--        let yyyy = d.getFullYear();-->

<!--        let hh = String(d.getHours()).padStart(2, '0');-->
<!--        let mi = String(d.getMinutes()).padStart(2, '0');-->

<!--        return `${hh}:${mi} ${dd}/${mm}/${yyyy}`;-->
<!--    }-->
<!--</script>-->

<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/header :: head"></head>

<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f7fa;
        margin: 0;
        padding: 20px;
    }

    h1 {
        text-align: center;
        color: #1a4971;
        margin-bottom: 30px;
        font-size: 2.2rem;
        font-weight: 600;
    }

    /* CƒÉn gi·ªØa b·∫£ng + responsive */
    .table-container {
        width: 95%;
        max-width: 1200px;
        margin: 0 auto;
        overflow-x: auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        padding: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin: 0 auto;
        font-size: 15px;
    }

    th {
        background: #1976d2;
        color: white;
        padding: 14px 8px;
        text-align: center;
        font-weight: 600;
    }

    td {
        text-align: center;
        vertical-align: middle;
        padding: 12px 8px;
    }

    tr:nth-child(even) {
        background-color: #f8fbff;
    }

    tr:hover {
        background-color: #edf4ff;
    }

    /* Button Chi ti·∫øt */
    .btn-view-schedule {
        background: #e3f2fd;
        color: #1976d2;
        border: none;
        padding: 9px 18px;
        font-size: 14px;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.25s ease;
        box-shadow: 0 2px 4px rgba(25, 118, 210, 0.15);
    }

    .btn-view-schedule:hover {
        background: #bbdefb;
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(25, 118, 210, 0.25);
    }

    .btn-view-schedule:active {
        transform: translateY(0);
    }

    /* C√°c style c≈© gi·ªØ nguy√™n */
    .status-active { background:#d4f8d4; color:#0f730c; padding:5px 10px; border-radius:6px; font-weight:bold; }
    .status-inactive { background:#fff4c2; color:#8a6d00; padding:5px 10px; border-radius:6px; font-weight:bold; }

    .st-pending { background:#ffe7a3; color:#8a6700; padding:4px 8px; border-radius:5px; font-weight:bold; }
    .st-confirmed { background:#c8ffd4; color:#0a6c20; padding:4px 8px; border-radius:5px; font-weight:bold; }
    .st-cancelled { background:#ffd1d1; color:#a30000; padding:4px 8px; border-radius:5px; font-weight:bold; }
    .st-completed { background:#d7e6ff; color:#003c91; padding:4px 8px; border-radius:5px; font-weight:bold; }

    .overlay {
        display:none; position:fixed; inset:0;
        background:rgba(0,0,0,0.5); backdrop-filter: blur(4px);
        z-index:999; justify-content:center; align-items:center;
    }

    .popup {
        background:white; width:780px; max-height:85vh;
        padding:25px; border-radius:16px;
        overflow-y:auto; position:relative;
        box-shadow:0 10px 30px rgba(0,0,0,0.3);
    }

    .btn-close {
        position:absolute;
        top:12px; right:12px;
        background:#e53935; color:white;
        padding:8px 14px; border:none;
        border-radius:8px; cursor:pointer;
        font-weight: bold;
        transition: 0.2s;
    }

    .btn-close:hover {
        background: #c62828;
    }

    .past { background:#e0e0e0; }
    .upcoming { background:#d8e9ff; }
</style>

<body>
<div th:replace="layout/header :: menu"></div>

<h1>Qu·∫£n l√Ω b√†n ƒÉn</h1>

<!-- B·∫£ng ƒë∆∞·ª£c b·ªçc trong div ƒë·ªÉ cƒÉn gi·ªØa + ƒë·∫πp h∆°n -->
<div class="table-container">
    <table>
        <tr>
            <th>ID</th>
            <th>T√™n b√†n</th>
            <th>S·ªë gh·∫ø</th>
            <th>Tr·∫°ng th√°i</th>
            <th>T·ªïng doanh thu</th>
            <th>L·ªãch ƒë·∫∑t b√†n</th>

<!--       @todo     qu·∫£n l√Ω order-->
<!--            m√≥n ƒë·ªÉ qu·∫£n l√Ω m√≥n c·ªßa b√†n in h√≥a ƒë∆°n in ƒë∆°n b·∫øp l√†m-->
        </tr>

        <tr th:each="t : ${tables}">
            <td th:text="${t[0]}"></td>
            <td th:text="${t[1]}"></td>
            <td th:text="${t[2]}"></td>

            <td>
                <span th:class="${#strings.equalsIgnoreCase(t[3],'ACTIVE') ? 'status-active' : 'status-inactive'}"
                      th:text="${#strings.equalsIgnoreCase(t[3],'ACTIVE') ? 'ƒêang ho·∫°t ƒë·ªông' : 'Ch∆∞a ho·∫°t ƒë·ªông'}">
                </span>
            </td>

            <td th:text="${#numbers.formatDecimal(t[4], 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>

            <td>
                <button class="btn-view-schedule"
                        th:data-table-id="${t[0]}"
                        th:data-table-name="${t[1]}"
                        onclick="handleShowSchedule(this)">
                    Chi ti·∫øt
                </button>
            </td>
        </tr>
    </table>
</div>

<!-- POPUP -->
<div id="overlay" class="overlay">
    <div class="popup" id="popup-content"></div>
</div>

<script>
    function handleShowSchedule(button) {
        const tableId = button.dataset.tableId;
        const tableName = button.dataset.tableName;
        showSchedule(tableId, tableName);
    }

    function closePopup() {
        document.getElementById("overlay").style.display = "none";
    }

    function showPopup(html) {
        document.getElementById("popup-content").innerHTML =
            '<button class="btn-close" onclick="closePopup()">ƒê√≥ng</button>' + html;
        document.getElementById("overlay").style.display = "flex";
    }

    async function showSchedule(tableId, tableName) {
        try {
            let res = await fetch(`/tables/${tableId}/schedule`);
            if (!res.ok) throw new Error("L·ªói t·∫£i d·ªØ li·ªáu");
            let data = await res.json();
            let now = new Date();

            if (data.length === 0) {
                showPopup(`<h3>L·ªãch ƒë·∫∑t b√†n ‚Äì ${tableName}</h3><p>Kh√¥ng c√≥ l·ªãch ƒë·∫∑t n√†o.</p>`);
                return;
            }

            let rows = data.map(r => {
                let start = new Date(r.start);
                let css = start < now ? "past" : "upcoming";

                let statusHtml =
                    r.status === "PENDING"   ? "<span class='st-pending'>Ch·ªù x√°c nh·∫≠n</span>" :
                        r.status === "CONFIRMED" ? "<span class='st-confirmed'>ƒê√£ x√°c nh·∫≠n</span>" :
                            r.status === "CANCELLED" ? "<span class='st-cancelled'>ƒê√£ h·ªßy</span>" :
                                "<span class='st-completed'>Th√†nh c√¥ng</span>";

                return `
                    <tr class="${css}">
                        <td>${r.customer || 'Kh√°ch l·∫ª'} (${r.phone || '‚Äî'})</td>
                        <td>${formatDate(r.start)}</td>
                        <td>${formatDate(r.end)}</td>
                        <td>${statusHtml}</td>
                    </tr>
                `;
            }).join("");

            let html = `
                <h3>L·ªãch ƒë·∫∑t b√†n ‚Äì ${tableName}</h3>
                <table style="width:100%; border-collapse:collapse; margin-top:15px;">
                    <tr style="background:#1976d2; color:white;">
                        <th style="padding:12px;">Kh√°ch h√†ng</th>
                        <th style="padding:12px;">B·∫Øt ƒë·∫ßu</th>
                        <th style="padding:12px;">K·∫øt th√∫c</th>
                        <th style="padding:12px;">Tr·∫°ng th√°i</th>
                    </tr>
                    ${rows}
                </table>
            `;

            showPopup(html);
        } catch (err) {
            showPopup(`<h3>L·ªói</h3><p>Kh√¥ng t·∫£i ƒë∆∞·ª£c l·ªãch ƒë·∫∑t b√†n. Vui l√≤ng th·ª≠ l·∫°i!</p>`);
        }
    }

    function formatDate(str) {
        let d = new Date(str);
        let dd = String(d.getDate()).padStart(2, '0');
        let mm = String(d.getMonth() + 1).padStart(2, '0');
        let yyyy = d.getFullYear();
        let hh = String(d.getHours()).padStart(2, '0');
        let mi = String(d.getMinutes()).padStart(2, '0');
        return `${hh}:${mi} ${dd}/${mm}/${yyyy}`;
    }
</script>

</body>
</html>